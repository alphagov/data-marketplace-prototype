{% extends "WIP/_layouts/main.html" %}

{% from "WIP/_macros/option-select.njk" import optionSelect %}

{% block pageTitle %}
  Find government data
{% endblock %}


{% block beforeContent %}

{{ govukPhaseBanner({
  tag: {
    text: "Beta"
  },
  html: 'This is a new service â€“ your <a class="govuk-link" href="#">feedback</a> will help us to improve it.'
}) }}

{% endblock %}

{% block content %}

<form action="" method="GET" id="searchForm">

    <input type="hidden" name="term" value="{{ term }}">

    <button id="hidden-search-button" style="display: none;">Search</button>

    <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-third">

            {% for filter in filters %}
               
                {{ optionSelect({
                    title: filter.title,
                    checkboxes: {
                        name: filter.title | lower,
                        classes: "govuk-checkboxes--small js-auto-submit",
                        attributes: {
                            "id": filter.id
                        },
                        fieldset: {
                            legend: {
                                text: filter.title,
                                classes: "govuk-fieldset__legend--s govuk-visually-hidden"
                            }
                        },
                        items: filter.items
                    }
                }) }}

            {% endfor %}

        </div>

        <div class="govuk-grid-column-two-thirds" role="region" aria-label="Search results">

            <div class="result-info">
                <div class="result-info__header">
                    <p class="govuk-!-colour-secondary" id="js-result-count">{{ count }} results</p>
                </div>
            </div>

            <div>
                <div class="govuk-form-group sort-options gem-c-select">
                    <label for="order" class="sort-options__label govuk-label">Sort by</label>
                    <select class="js-order-results govuk-select sort-options__select" name="order" id="order">
                        <option value="updated-newest" selected >
                            Added (newest)
                        </option>
                        <option value="updated-oldest">Added (oldest)</option>
                    </select>
                </div>
            </div>


            {% if listings.length > 0 %}
                <div class="govuk-!-margin-bottom-5">
                    {% for listing in listings %}
                    <div class="govuk-!-margin-bottom-7">

                        <p class="govuk-!-margin-bottom-3">
                            <a href="/WIP/listings/{{ listing.slug | urlencode }}" class="govuk-!-font-weight-bold govuk-link">
                                {{ listing.title }}
                            </a>
                        </p>

                        <p class="govuk-!-margin-bottom-3 govuk-!-colour-secondary">
                            {{ listing.organisation }}
                        </p>

                        {% if listing.type == "API" %}

                            <div class="govuk-!-margin-bottom-4">
                                {{ govukTag({
                                    'text': 'API',
                                    classes: "govuk-tag--grey govuk-!-font-size-16"
                                })}}
                            </div>

                        {% endif %}


                        {% if listing.access == "On request" %}

                            <div class="govuk-!-margin-bottom-4">
                                {{ govukTag({
                                    'text': 'Access on request',
                                    classes: "govuk-tag--grey govuk-!-font-size-16"
                                })}}
                            </div>

                        {% endif %}

                        <!-- <p class="govuk-!-display-inline">
                            {% for distribution in result.distributions %}
                                <strong class="govuk-tag govuk-tag--grey">{{ distribution }}</strong>
                            {% endfor %}
                        </p> -->
                        
                        <div class="govuk-!-margin-bottom-0 govuk-!-margin-top-1">
                            <p class="govuk-!-font-size-16">
                                {{ listing.summary | truncate(280) }}
                            </p>
                        </div>
                        
                    </div>
                    {% endfor %}
                </div>

                {{ govukPagination({
                    next: {
                        text: "Next page",
                        href: pagination.next.href
                    }
                  }) }}
                
            {% else %}
            <div class="no-results govuk-!-font-size-19"> 
                <p class="govuk-body govuk-!-font-weight-bold">There are no matching results.</p>
                 <p class="govuk-body">Improve your search results by:</p> 
                 <ul class="govuk-list govuk-list--bullet"> 
                    <li>removing filters</li> 
                    <li>double-checking your spelling</li> 
                    <li>using fewer keywords</li> 
                    <li>searching for something less specific</li> 
                </ul>
            </div>
            {% endif %}
        </div>
    </div>

</form>

{% endblock %}

{% block footer %}
{% include "includes/WIP_footer.html" %}
{% endblock %}

{% block pageScripts %}
    <script src="/public/javascripts/option-select.js"></script>
    <script>
        document.querySelectorAll('[data-module="option-select"]').forEach(function(element) {
            new GOVUK.Modules.OptionSelect(element).init()
        });
    </script>
{% endblock %}
